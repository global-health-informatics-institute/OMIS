<%# GENDER - PIE CHART %>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('genderChart')?.getContext('2d');
    if (!ctx) return; // Safeguard

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Female', 'Male', 'Other'],
        datasets: [{
          data: [<%= @gender_age[:gender_female] %>, <%= @gender_age[:gender_male] %>, <%= @gender_age[:gender_other] %>],
          backgroundColor: ['#FBB6CE', '#2C5282', '#6B7280'],
          borderWidth: 0,
        }]
      },
      options: {
        cutout: '60%',
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: context => `${context.label}: ${context.parsed}%`
            }
          }
        }
      }
    });
  });
</script>

<%# AGE - BAR GRAPH %>
<script>
  const ageCtx = document.getElementById('ageChart').getContext('2d');
  new Chart(ageCtx, {
    type: 'bar',
    data: {
      labels: ['18-24', '25-29', '30-44', '45-60', '60+'],
      datasets: [{
        label: 'Employees',
        data: [
          <%=@gender_age[:age_18_25]%>,
          <%=@gender_age[:age_26_35]%>,
          <%=@gender_age[:age_36_45]%>,
          <%=@gender_age[:age_46_55]%>,
          <%=@gender_age[:age_56_65]%>,
          <%=@gender_age[:above_65]%>,
        ],
        backgroundColor: [
          'rgba(191, 219, 254, 0.8)',  // light blue
          'rgba(110, 231, 183, 0.9)',  // mint
          'rgba(34, 197, 94, 0.9)',    // green
          'rgba(20, 184, 166, 0.9)',   // teal
          'rgba(203, 213, 225, 0.8)'   // gray (zero value)
        ],
        borderRadius: 11,
        barThickness: 86
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: {
          grid: { color: '#E5E7EB' },
          ticks: {
            color: '#4B5563',
            font: { size: 26, weight: '800' }
          }
        },
        y: {
          grid: { color: '#E5E7EB' },
          ticks: {
            beginAtZero: true,
            stepSize: 10,
            color: '#4B5563',
            font: { size: 24, weight: '800' }
          }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: context => ` ${context.parsed.y} employees`
          }
        }
      }
    }
  });
</script>

<%# RETENTION - TREND %>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const retentionCtx = document.getElementById('rententionChart')?.getContext('2d');
    if (!retentionCtx) return; // Safeguard

    new Chart(retentionCtx, {
      type: 'line',
      data: {
        labels: [
          <% @tenure[:past_four_year_quarters].each do |quarter| %>
            '<%= (quarter).gsub('20', '') %>',
          <% end %>
        ],

        datasets: [{
          label: 'Retention Rate',
          data: [
            <% @tenure[:past_four_year_quarter_trend].each do |trend| %>
              <%= trend %>,
            <% end %>
          ],
          borderColor: '#3B82F6',
          borderWidth: 6,
          fill: false,
          tension: 0.3,
          pointRadius: 4,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
          padding: {
            top: 0,
            right: 0,
            bottom: 0,  
            left: 0
          }
        },
        scales: {
          x: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: { color: '#6B7280', font: { size: 22, weight: 'semi-bold' } },
            padding: 10,
          },
          y: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: {
             color: '#6B7280',
             font: { size: 22, weight: 'bold' },
             stepSize: 5,
             callback: function(value) {
              return (value > 100 ? null : value) &&  (value < (<%= (@tenure[:past_four_year_quarter_trend].compact.min || 0) %>) ? null : value)
            }
            },
            min: (<%= (@tenure[:past_four_year_quarter_trend].compact.min || 0) %>) - 5,
            max: 100 + 5, // but how about if the max is 105 but it should not show 105 value only the 100 part
          }
        },
        plugins: {
          legend: { display: false },
        }
      }
    });
  });
</script>

<%# monlthy growth %>
<script>
  window.onload = function () {
    const growthCtx = document.getElementById('growthChart').getContext('2d');
    new Chart(growthCtx, {
      type: 'line',
      data: {
        labels: [
          <% @tenure[:past_four_months].each do |month| %>
            '<%= month %>',
          <% end %>
        ],

        datasets: [{
          label: 'Headcount',
          data: [
            <% @tenure[:past_four_months_trend].each do |headcount| %>
              <%= headcount %>,
            <% end %>
          ],
          borderColor: '#3B82F6',
          borderWidth: 6,
          fill: false,
          tension: 0.8,
          pointRadius: 4,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
          padding: {
            top: 0,
            right: 0,
            bottom: 0,  
            left: 0
          }
        },
        scales: {
          x: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: { color: '#6B7280', font: { size: 26, weight: 'semi-bold' } }
          },
          y: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: { color: '#6B7280', font: { size: 26, weight: 'bold' },
             stepSize: 4,
             callback: function(value) {
              return ((value >= (<%= @tenure[:past_four_months_trend].max  %>) + 4) ? null : value) &&  ((value <= (<%= @tenure[:past_four_months_trend].min %>) - 4) ? null : value)
            }
            },
            min: (<%= @tenure[:past_four_months_trend].min %>) - 4,
            max: (<%= @tenure[:past_four_months_trend].max  %>) + 4,
          }
        },
        plugins: {
          legend: { display: false },
        }
      }
    });
  };
</script>

<%# WORKFORCE - BAR GRAPH %>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const workforceCtx = document.getElementById('workforceChart')?.getContext('2d');
    if (!workforceCtx) return; // Safeguard

    new Chart(workforceCtx, {
      type: 'bar',
      data: {
        labels: [
          <% @tenure[:workforce_types].each do |type| %>
            '<%= type %>',
          <% end %>
        ],
        datasets: [{
          label: 'Employees',
          data: [
            <% @tenure[:workforce_type_distribution].each do |distribution| %>
              <%= distribution %>,
            <% end %>
          ],
          backgroundColor: [
            'rgba(87, 92, 99, 0.8)',  // light blue
            'rgba(110, 231, 183, 0.9)',  // mint
            'rgba(34, 197, 94, 0.9)',    // green
            'rgba(20, 184, 166, 0.9)',   // teal
          ],
          borderRadius: 11,
          barThickness: 80
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            grid: { color: '#E5E7EB' },
            ticks: {
              color: '#4B5563',
              font: { size: 28, weight: '800' }
            }
          },
          y: {
            grid: { color: '#E5E7EB' },
            ticks: {
              beginAtZero: true,
              stepSize: 5,
              color: '#4B5563',
              font: { size: 26, weight: '800' }
            }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: context => ` ${context.parsed.y} employees`
            }
          }
        }
      }
    });
  });
</script>
