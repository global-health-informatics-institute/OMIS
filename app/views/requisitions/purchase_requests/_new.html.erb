<%= form_with model: @requisition, 
              url: create_purchase_request_path, 
              method: :post, 
              local: true, 
              html: { 
                id: "multiStepForm", 
                data: { 
                  controller: "purchase",
                  purchase_current_state_value: @requisition.current_state,
                  purchase_threshold_value: @purchase_request_threshold,
                  purchase_requisition_id_value: @requisition.id
                } 
              } do |form| %>
  <div class="container-fluid mt-4 ml-4 mr-4">
    <div class="card w-100 shadow-sm">
      
      <!-- Step content container -->
      <div class="tab-content border" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-step1" role="tabpanel">
          <%= render 'requisitions/requested_purchase_request', form: form %>
        </div>

        <div class="tab-pane fade" id="nav-step3" role="tabpanel">
          <%= render 'requisitions/purchase_requests/payment_request_form', form: form %>
        </div>
         
        <div class="tab-pane fade" id="nav-step4" role="tabpanel">
          <%= render 'requisitions/purchase_requests/proof_of_payment', form: form %>
        </div>

        <div class="tab-pane fade" id="nav-step5" role="tabpanel">
          <%= render 'requisitions/purchase_requests/confirm_delivery_form', form: form %>
        </div>

        <div class="tab-pane fade" id="nav-step6" role="tabpanel">
          <%= render 'requisitions/purchase_requests/asset_registration_form', form: form %>
        </div>
      </div>

      <!-- Keep hidden field for form submission -->
      <%= form.hidden_field :current_state, value: @requisition.current_state %>
      
      <!-- Navigation buttons -->
      <div class="d-flex justify-content-between align-items-center mt-3 p-3 bg-light">
        <div>
          <button type="button" class="btn btn-secondary" 
                  data-purchase-target="previousButton" 
                  data-action="click->purchase#previousStep">
            <i class="fas fa-arrow-left me-2"></i>Previous
          </button>
        </div>
        <div>
          <button type="button" class="btn btn-primary me-2" 
                  data-purchase-target="nextButton" 
                  data-action="click->purchase#nextStep">
            Next <i class="fas fa-arrow-right ms-2"></i>
          </button>
          <%= form.submit "Submit Request", 
                class: "btn btn-success d-none", 
                data: { purchase_target: "submitButton" } %>
        </div>
      </div>
    </div>
  </div>
<% end %>