<%= form_with model: @requisition, url: register_asset_path(@requisition), multipart: true, method: :patch, local: true do |form| %>
  <div class="row mt-3 p-2">
    <div class="col p-2">
      <div class="card">
        <div class="card-header card-header-dark">
          <div class="row">
            <div class="col col-md-10">
              <h5>Asset Registration Form</h5>
            </div>
            <div class="col col-md-2">
              <span class="fw-bold fst-italic">Status: <%= @requisition.current_state %></span>
            </div>
          </div>
        </div>

        <div class="card-body">
          <% if @asset&.errors&.any? %>
            <div class="alert alert-danger">
              <h5>Please fix the following errors:</h5>
              <ul>
                <% @asset.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>
          
          <!-- Asset Details -->
          <div class="row mb-3">
            <div class="col-md-6">
              <%= form.label :asset_category_id, "Asset Category", class: "form-label" %>
              <%= form.select :asset_category_id,
                options_from_collection_for_select(@categories, :id, :category),
                { include_blank: "Select asset category" },
                { class: "form-select", required: true } %>
            </div>

            <div class="col-md-6">
              <%= form.label :description, "Description", class: "form-label" %>
              <%= form.text_field :description, placeholder: 'Enter asset description', class: "form-control", required: true %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <%= form.label :status, "Status", class: "form-label" %>
              <%= form.text_field :status, placeholder: 'Enter asset status', class: "form-control", required: true %>
            </div>

            <div class="col-md-6">
              <%= form.label :make, "Make", class: "form-label" %>
              <%= form.text_field :make, placeholder: 'Enter asset make', class: "form-control", required: true %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <%= form.label :model, "Model", class: "form-label" %>
              <%= form.text_field :model, placeholder: 'Enter asset model', class: "form-control", required: true %>
            </div>

            <div class="col-md-6">
              <%= form.label :serial_number, "Serial Number", class: "form-label" %>
              <%= form.text_field :serial_number, placeholder: 'Enter asset serial number', class: "form-control", required: true %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <%= form.label :location, "Location", class: "form-label" %>
              <%= form.text_field :location, placeholder: 'Enter asset location', class: "form-control", required: true %>
            </div>

            <div class="col-md-6">
              <%= form.label :value, "Value (MWK)", class: "form-label" %>
              <%= form.number_field :value, class: "form-control", step: "0.01", min: "0.01", placeholder: "Enter asset value", required: true %>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <%= form.label :tag_id, "Asset Tag ID", class: "form-label" %>
              <%= form.text_field :tag_id, placeholder: 'Enter asset tag ID', class: "form-control", required: true %>
            </div>
          </div>

          <%= form.hidden_field :requisition_id, value: @requisition.id %>

          <div class="row mt-4">
            <div class="col">
              <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" 
                        data-action="click->purchase#goToStep1">
                  <i class="fas fa-arrow-left me-2"></i>Back to Step 1
                </button>
                <%= form.submit "Save", class: "btn btn-success" %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>