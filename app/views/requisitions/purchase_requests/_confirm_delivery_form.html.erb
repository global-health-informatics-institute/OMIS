<%= form_with model: @requisition, url: complete_procurement_purchase_request_path(@requisition), multipart: true, method: :patch do |form| %>
  <div class="container m-4">
    <div class="row mt-3 p-2">
      <div class="col p-2">
        <div class="card">
          <div class="card-header card-header-dark">
            <div class="row">
              <div class="col col-md-9">
                <h5>Purchase Request</h5>
              </div>
              <div class="col col-md-3 text-end">
                <span class="fw-bold fst-italic">Status: <%= @requisition.current_state %></span>
              </div>
            </div>
          </div>

          <div class="card-body">
            <div class="row mt-3 mb-4">
  <div class="col-md-4">
    <div class="fw-normal">Item Requested</div>
    <div class="fw-bold fst-italic">
      <%= @requisition.purchase_request_attachment&.item_requested %>
    </div>
  </div>

  <div class="col-md-4">
    <div class="fw-normal">Quantity</div>
    <div class="fw-bold fst-italic">
      <%= @requisition.quantity %>
    </div>
  </div>

  <div class="col-md-4">
    <div class="fw-normal">Item Description</div>
    <div class="fw-bold fst-italic">
      <%= @requisition.item_description %>
    </div>
  </div>
</div>

<div class="row mt-3 mb-4">
  <div class="col-md-6">
    <div class="fw-normal">Budget Line Reference</div>
    <div class="fw-bold fst-italic">
      <%= @requisition.budget_line_reference %>
    </div>
  </div>

  <div class="col-md-6">
    <div class="fw-normal">Donor</div>
    <div class="fw-bold fst-italic">
      <%= @requisition.purchase_request_attachment&.stakeholder&.stakeholder_name %>
    </div>
  </div>
</div>


            <!-- Confirm Delivery Button (only if allowed) -->
            <% if @possible_actions&.include?("Confirm Delivery") && !@requisition.went_through_ipc? %>
              <div class="row mb-4 justify-content-center">
                <div class="col-md-10">
                  <div class="d-flex justify-content-center gap-4 flex-wrap">
                    <div class="flex-fill text-center">
                      <%= link_to "Confirm Delivery",
                                  "/purchase_requests/#{@requisition.id}/confirm_delivery",
                                  class: "btn btn-outline-success w-100 py-4 fs-5 fw-semibold",
                                  method: :put,
                                  data: {
                                    turbo_method: :put,
                                    turbo_confirm: "Are you sure you want to confirm delivery of this request?"
                                  } %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
         <!-- Confirm Item Delivery Button (for IPC flow and non-IPC LPO Issued) -->
            <% if @possible_actions&.include?("Confirm Item Delivery") && (@requisition.went_through_ipc? || @requisition.current_state == 'LPO Issued') %>
              <div class="row mb-4 justify-content-center">
                <div class="col-md-10">
                  <div class="d-flex justify-content-center gap-4 flex-wrap">
                    <div class="flex-fill text-center">
                      <%= link_to "Confirm Item Delivery",
                                  "/purchase_requests/#{@requisition.id}/confirm_item_delivery",
                                  class: "btn btn-outline-success w-100 py-4 fs-5 fw-semibold",
                                  method: :put,
                                  data: {
                                    turbo_method: :put,
                                    turbo_confirm: "Are you sure you want to confirm delivery of this request?"
                                  } %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
               <!-- Your other form content below this -->

          </div> <!-- /card-body -->
        </div> <!-- /card -->
      </div> <!-- /col -->
    </div> <!-- /row -->
  </div> <!-- /container -->
<% end %>
