<%# RETENTION - TREND %>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const retentionCtx = document.getElementById('rententionChart')?.getContext('2d');
    if (!retentionCtx) return; // Safeguard

    new Chart(retentionCtx, {
      type: 'line',
      data: {
        labels: [
          <% @metadata[:past_four_year_quarters].each do |quarter| %>
            '<%= (quarter).gsub('20', '') %>',
          <% end %>
        ],

        datasets: [{
          label: 'Retention Rate',
          data: [
            <% @metadata[:past_four_year_quarter_trend].each do |trend| %>
              <%= trend %>,
            <% end %>
          ],
          borderColor: '#3B82F6',
          borderWidth: 6,
          fill: false,
          tension: 0.3,
          pointRadius: 4,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
          padding: {
            top: 20,
            right: 20,
            bottom: 0,  
            left: 0
          }
        },
        scales: {
          x: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: { color: '#6B7280', font: { size: 22, weight: 'semi-bold' } },
            padding: 20,
          },
          y: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: {
             color: '#6B7280',
             font: { size: 22, weight: 'bold' },
             stepSize: 5,
             callback: function(value) {
              return (value > 100 ? null : value) &&  (value < (<%= (@metadata[:past_four_year_quarter_trend].compact.min || 0) %>) ? null : value)
            }
            },
            min: (<%= (@metadata[:past_four_year_quarter_trend].compact.min || 0) %>) - 5,
            max: 100 + 10, // but how about if the max is 105 but it should not show 105 value only the 100 part
          }
        },
        plugins: {
          legend: { display: false },
        }
      }
    });
  });
</script>


<%# monlthy growth %>
<script>
  window.onload = function () {
    const growthCtx = document.getElementById('growthChart').getContext('2d');
    new Chart(growthCtx, {
      type: 'line',
      data: {
        labels: [
          <% @metadata[:past_four_months].each do |month| %>
            '<%= month %>',
          <% end %>
        ],

        datasets: [{
          label: 'Headcount',
          data: [
            <% @metadata[:past_four_months_trend].each do |headcount| %>
              <%= headcount %>,
            <% end %>
          ],
          borderColor: '#3B82F6',
          borderWidth: 6,
          fill: false,
          tension: 0.8,
          pointRadius: 4,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
          padding: {
            top: 0,
            right: 20,
            bottom: 0,  
            left: 0
          }
        },
        scales: {
          x: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: { color: '#6B7280', font: { size: 26, weight: 'semi-bold' } }
          },
          y: {
            grid: { color: '#E5E7EB', drawBorder: true },
            ticks: { color: '#6B7280', font: { size: 26, weight: 'bold' },
             stepSize: 4,
             callback: function(value) {
              return ((value >= (<%= @metadata[:past_four_months_trend].max  %>) + 8) ? null : value) &&  ((value <= (<%= @metadata[:past_four_months_trend].min %>) - 8) ? null : value)
            }
            },
            min: (<%= @metadata[:past_four_months_trend].min %>) - 8,
            max: (<%= @metadata[:past_four_months_trend].max  %>) + 8,
          }
        },
        plugins: {
          legend: { display: false },
        }
      }
    });
  };
</script>



<%# WORKFORCE - BAR GRAPH %>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const workforceCtx = document.getElementById('workforceChart')?.getContext('2d');
    if (!workforceCtx) return; // Safeguard

    new Chart(workforceCtx, {
      type: 'bar',
      data: {
        labels: [
          <% @metadata[:workforce_types].each do |type| %>
            '<%= type %>',
          <% end %>
        ],
        datasets: [{
          label: 'Employees',
          data: [
            <% @metadata[:workforce_type_distribution].each do |distribution| %>
              <%= distribution %>,
            <% end %>
          ],
          backgroundColor: [
            'rgba(87, 92, 99, 0.8)',  // light blue
            'rgba(110, 231, 183, 0.9)',  // mint
            'rgba(34, 197, 94, 0.9)',    // green
            'rgba(20, 184, 166, 0.9)',   // teal
          ],
          borderRadius: 11,
          barThickness: 90
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            grid: { color: '#E5E7EB' },
            ticks: {
              color: '#4B5563',
              font: { size: 28, weight: '800' }
            }
          },
          y: {
            grid: { color: '#E5E7EB' },
            ticks: {
              beginAtZero: true,
              stepSize: 10,
              color: '#4B5563',
              font: { size: 26, weight: '800' }
            }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: context => ` ${context.parsed.y} employees`
            }
          }
        }
      }
    });
  });
</script>
