<!DOCTYPE html>
<html>
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
  <style>
    body {
      font-family: 'Trebuchet MS', sans-serif;
    }
  </style>
</head>
<body style="background-color: #F3F4F6; padding: 20px;">

  <div style="border: 1px solid #002130; width: 100%; margin: 0 auto;">
    <div style="background-color: #002130; font-weight: bold; color: #E3E4E7; padding: 20px; text-align: center; font-size: 1.5rem;">
      Purchase Request Approval Required
    </div>

    <div style="padding: 30px; font-size: 1.2rem;">
      <p>
        Dear <%= @supervisor.person.full_name %>,
      </p>

      <p>
        You have a new purchase request awaiting your approval from
        <strong><%= @requester.person.full_name %></strong>.
      </p>

      <p>
        <strong>Request Details:</strong><br>
        <strong>Request ID:</strong> <%= @requisition.id %><br>
        <strong>Item Requested:</strong> <%= @requisition.purchase_request_attachment&.item_requested || @requisition.requisition_items.first&.item_description %><br>
        <strong>Quantity:</strong> <%= @requisition.requisition_items.first&.quantity || 'Not specified' %><br>
        <strong>Purpose:</strong> <%= @requisition.purpose %><br>
        <strong>Budget Line Reference:</strong> <%= @requisition.budget_line_reference %><br>
        <strong>Department:</strong> <%= @requisition.department&.department_name || 'Not specified' %><br>
        <strong>Submitted:</strong> <%= @requisition.created_at.strftime("%A, %B %d, %Y at %I:%M %p") %><br>
      </p>

      <p>
        Please log into OMIS to review and approve this purchase request.
      </p>

      <p>
        <strong>OMIS Link:</strong> <a href="<%= Rails.application.config.omis_url %>" style="color: #002130;"><%= Rails.application.config.omis_url %></a>
      </p>

      <p style="margin-top: 20px;">
        <strong>Or use the links below for quick action:</strong>
      </p>

      <div style="display: flex; flex-direction: column; gap: 20px; margin-top: 15px;">
        <%= form_with(url: url_for(controller: 'purchase_requests', action: 'reject_request', id: @requisition.id, host: Rails.application.config.omis_url), method: :put) do |f| %>
          <%= f.submit "Reject Request", style: "display: block; width: 100%; padding: 12px 20px; background-color: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; text-align: center; font-size: 16px; font-weight: bold;",
                     onclick: "if(!confirm('Are you sure you want to reject this request?')) return false;" %>
        <% end %>

        <%= form_with(url: url_for(controller: 'purchase_requests', action: 'approve_request', id: @requisition.id, host: Rails.application.config.omis_url), method: :put) do |f| %>
          <%= hidden_field_tag :reviewer_first_name, @supervisor.person.first_name %>
          <%= f.submit "Approve Request", style: "display: block; width: 100%; padding: 12px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; text-align: center; font-size: 16px; font-weight: bold;",
                     onclick: "if(!confirm('Are you sure you want to approve this request?')) return false;" %>
        <% end %>
      </div>

      <p>
        Your prompt attention to this matter is greatly appreciated.
      </p>
    </div>
  </div>

  <div style="margin-top: 30px; text-align: center; font-size: 0.9rem; color: #6c757d;">
    <p>This is an automated notification. <%= Time.current.year %></p>
  </div>

</body>
</html>
